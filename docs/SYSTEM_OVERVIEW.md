# Обзор Системы: CI/CD и Управление Конфигурацией

Этот документ описывает текущую архитектуру автоматического развертывания (CI/CD) и управления секретами проекта.

## 1. Управление Конфигурацией и Секретами

**Единый источник правды для всех секретов — Google Secret Manager.**

### Ключевые Секреты:

*   `NEXT_PUBLIC_FIREBASE_CONFIG`:
    *   **Назначение:** Содержит **полный JSON-объект** конфигурации Firebase для клиентской части.
    *   **Пример:**
        ```json
        {
          "apiKey": "...",
          "authDomain": "...",
          ...
        }
        ```
    *   **Использование:** Код в `src/lib/firebase.ts` парсит эту JSON-строку для инициализации Firebase.

*   `BIBLIO_GLOBUS_LOGIN`, `BIBLIO_GLOBUS_PASSWORD`, `GOOGLE_PLACES_API_KEY`:
    *   **Назначение:** Остальные секреты, необходимые для работы API.

## 2. Процесс Развертывания (CI/CD)

Процесс полностью автоматизирован с помощью **GitHub Actions** и **Firebase App Hosting**.

1.  **Триггер:** Пуш в ветку `main`.
2.  **Воркфлоу:** Запускается файл `.github/workflows/deploy.yml`.
3.  **Аутентификация:**
    *   Происходит через **Workload Identity Federation**.
    *   **Ключевое отличие:** Мы **не используем** долгоживущие JSON-ключи сервисных аккаунтов (т.е. секрета `FIREBASE_SERVICE_ACCOUNT` в GitHub больше нет). GitHub Actions получает временный токен доступа для выполнения развертывания.
4.  **Развертывание:**
    *   Воркфлоу устанавливает `firebase-tools` и напрямую выполняет команду `firebase deploy --only hosting:studio`, которая **запускает** процесс сборки на стороне Firebase App Hosting.
    *   Во время сборки **сам App Hosting** обращается к Secret Manager, извлекает значения секретов и внедряет их в приложение как переменные окружения.

> **Важно:** Секреты приложения никогда не передаются напрямую в лог или артефакты GitHub Actions.

## 3. Локальная Разработка

Для работы приложения на локальной машине:

1.  Создайте файл `.env.local` в корне проекта (он уже добавлен в `.gitignore` и не попадет в репозиторий).
2.  Добавьте в него необходимые переменные окружения. Как минимум, вам понадобится `NEXT_PUBLIC_FIREBASE_CONFIG`.

    **Пример `.env.local`:**
    ```
    NEXT_PUBLIC_FIREBASE_CONFIG='{"apiKey":"...","authDomain":"...","projectId":"...","storageBucket":"...","messagingSenderId":"...","appId":"..."}'
    
    # Другие переменные, если они нужны локально
    # GOOGLE_PLACES_API_KEY="..."
    ```
    *Обратите внимание, что весь JSON должен быть в одной строке и заключен в одинарные кавычки.*
